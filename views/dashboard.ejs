<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <title>Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-icons/3.0.1/iconfont/material-icons.min.css">
  <link rel="stylesheet" href="/css/Customizable-Background--Overlay.css">
  <link rel="stylesheet" href="/css/Data-Table-styles.css">
  <link rel="stylesheet" href="/css/Data-Table.css">
  <link rel="stylesheet" href="/css/Footer-Dark-icons.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css">
  <link rel="stylesheet" href="/css/Login-Form-Basic-icons.css">
  <link rel="stylesheet" href="/css/Soft-UI-Aside-Navbar.css">
  <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
</head>

<body>
  <!-- Start: Navbar Right Links -->
  <nav class="navbar navbar-light navbar-expand-md py-3">
    <div class="container"><a class="navbar-brand d-flex align-items-center" href="#"><span class="bs-icon-sm bs-icon-rounded bs-icon-primary d-flex justify-content-center align-items-center me-2 bs-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -32 576 576" width="1em" height="1em" fill="currentColor">
            <path d="M144.3 32.04C106.9 31.29 63.7 41.44 18.6 61.29c-11.42 5.026-18.6 16.67-18.6 29.15l0 357.6c0 11.55 11.99 19.55 22.45 14.65c126.3-59.14 219.8 11 223.8 14.01C249.1 478.9 252.5 480 256 480c12.4 0 16-11.38 16-15.98V80.04c0-5.203-2.531-10.08-6.781-13.08C263.3 65.58 216.7 33.35 144.3 32.04zM557.4 61.29c-45.11-19.79-88.48-29.61-125.7-29.26c-72.44 1.312-118.1 33.55-120.9 34.92C306.5 69.96 304 74.83 304 80.04v383.1C304 468.4 307.5 480 320 480c3.484 0 6.938-1.125 9.781-3.328c3.925-3.018 97.44-73.16 223.8-14c10.46 4.896 22.45-3.105 22.45-14.65l.0001-357.6C575.1 77.97 568.8 66.31 557.4 61.29z"></path>
          </svg></span><span class="ms-2 font-weight-bolder">School Library</span></a><button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-2"><span class="visually-hidden">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navcol-2">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link active" href="/dashboard">Dashboard</a></li>
          <% if( session.user.type === "manager") {%>
            <li class="nav-item"><a class="nav-link" href="/management">Management</a></li>
          <% } %>
          <li class="nav-item"><a class="nav-link" href="/books">Books</a></li>
          <li class="nav-item"><a class="nav-link" href="/profile">Profile</a></li>
        </ul>
        <form name="logoutForm" method="POST" action="/logout">
          <input type="hidden">
          <a class="btn btn-primary ms-md-2" role="button" href="javascript:document.logoutForm.submit();" style="--bs-btn-bg: #fd800d;--bs-btn-border-color: #fd800d;--bs-btn-hover-color: #fff;--bs-btn-hover-bg: #d7610b;--bs-btn-hover-border-color: #ca4f0a;">Logout</a>
        </form>
      </div>
    </div>
  </nav><!-- End: Navbar Right Links -->
  <div class="container py-4 py-xl-5">
    <div class="row gy-4 row-cols-2 row-cols-md-4">
      <div class="col">
        <div class="text-center d-flex flex-column justify-content-center align-items-center py-3">
          <div class="bs-icon-xl bs-icon-circle bs-icon-primary d-flex flex-shrink-0 justify-content-center align-items-center d-inline-block mb-2 bs-icon"><i class="material-icons" style="font-size: 46px;">library_books</i></div>
          <div class="px-3">
            <h2 class="fw-bold mb-0"><%=loans.length%></h2>
            <p class="mb-0">Total Book Loans</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="text-center d-flex flex-column justify-content-center align-items-center py-3">
          <div class="bs-icon-xl bs-icon-circle bs-icon-primary d-flex flex-shrink-0 justify-content-center align-items-center d-inline-block mb-2 bs-icon"><i class="fa fa-cart-plus"></i></div>
          <div class="px-3">
            <h2 class="fw-bold mb-0"><%=reservations.length%></h2>
            <p class="mb-0">Active Reservations</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="text-center d-flex flex-column justify-content-center align-items-center py-3">
          <div class="bs-icon-xl bs-icon-circle bs-icon-primary d-flex flex-shrink-0 justify-content-center align-items-center d-inline-block mb-2 bs-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="-32 0 512 512" width="1em" height="1em" fill="currentColor">
              <path d="M448 336v-288C448 21.49 426.5 0 400 0H96C42.98 0 0 42.98 0 96v320c0 53.02 42.98 96 96 96h320c17.67 0 32-14.33 32-31.1c0-11.72-6.607-21.52-16-27.1v-81.36C441.8 362.8 448 350.2 448 336zM143.1 128h192C344.8 128 352 135.2 352 144C352 152.8 344.8 160 336 160H143.1C135.2 160 128 152.8 128 144C128 135.2 135.2 128 143.1 128zM143.1 192h192C344.8 192 352 199.2 352 208C352 216.8 344.8 224 336 224H143.1C135.2 224 128 216.8 128 208C128 199.2 135.2 192 143.1 192zM384 448H96c-17.67 0-32-14.33-32-32c0-17.67 14.33-32 32-32h288V448z"></path>
            </svg></div>
          <div class="px-3">
            <h2 class="fw-bold mb-0"><%=activeLoansCount%></h2>
            <p class="mb-0">Current Loans</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="text-center d-flex flex-column justify-content-center align-items-center py-3">
          <div class="bs-icon-xl bs-icon-circle bs-icon-primary d-flex flex-shrink-0 justify-content-center align-items-center d-inline-block mb-2 bs-icon"><i class="fa fa-star"></i></div>
          <div class="px-3">
            <h2 class="fw-bold mb-0">6</h2>
            <p class="mb-0">Reviews</p>
          </div>
        </div>
      </div>
    </div>
    <h4 >Your Reservations</h4>
    <table id="reservations" class="table table-striped table-bordered" cellspacing="0" width="100%">
      <thead>
        <tr>
          <th>Book</th>
          <th>Date</th>
          <th>Date Due</th>
        </tr>
      </thead>
      <tbody>
        <% reservations.forEach(book=> { %>
        <tr>
          <td>
            <%= book.title %>
          </td>
          <td>
            <%= book.date.toISOString().split("T")[0] %>
          </td>
          <td>
            <%= book.date_due.toISOString().split("T")[0] %>
          </td>
        </tr>
        <% }); %>
      </tbody>
    </table>
      <h4 >Your Loans</h4>
      <table id="loans" class="table table-striped table-bordered" cellspacing="0" width="100%">
        <thead>
          <tr>
            <th>Book</th>
            <th>Date Out</th>
            <th>Date Due</th>
            <th>Date in</th>
          </tr>
        </thead>
        <tbody>
    <% loans.forEach(book=> { %>
          <tr>
            <td><%= book.title %></td>
            <td>
              <%= book.date_out.toISOString().split("T")[0] %>
            </td>
            <td>
              <%= book.date_due.toISOString().split("T")[0] %>
            </td>
            <%if(book.date_in) {%>
            <td>
              <%= book.date_in.toISOString().split("T")[0]%>
            </td>
            <%} else {%>
            <td>-</td>
            <%}%>
            </tr>
      <% }); %>
        </tbody>
      </table>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>